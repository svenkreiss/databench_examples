{% from 'macros.html' import include_src, include_md %}
{% extends "base.html" %}


{% block title %}bagofcharsd3{% endblock %}


{% block head %}
<style>
p{
    max-width: 60em;
}
path.slice{
    stroke-width: 2px;
}
polyline{
    opacity: .3;
    stroke: black;
    stroke-width: 2px;
    fill: none;
}
</style>
{% endblock %}


{% block content %}
<h1>Bag of Chars</h1>

<input type="text" class="form-control" id="sentence"
       placeholder="type a phrase"
       autocomplete="off" autofocus />

<br />
<div id="viz" style="height: 300px; width: 100%;"></div>

[[ include_md('bagofcharsd3/README.md') ]]

<h3>Log</h3>
<pre id="log"></pre>
{% endblock %}


{% block footerscripts %}
<script src="/bagofcharsd3/static/d3charcount.js?version=1"></script>
<script>
    var databench = Databench();

    $('#sentence').on('keyup', function(event) {
        databench.emit('sentence', {sentence: $(this).val()});
    });


    var d3viz = d3charcount('viz');

    databench.on('counts', function(msg) {
        console.log(msg);
        var reformattedData = Object.keys(msg).map(function(letter) {
            return {label:letter, value:msg[letter]};
        });
        console.log(reformattedData);
        if (reformattedData.length > 0) d3viz(reformattedData);
    });

    databench.emit('sentence', {sentence:'type a phrase'});
</script>
{% endblock %}
